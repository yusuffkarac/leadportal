generator client {
  provider      = "prisma-client-js"
  output        = "../generated/prisma"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String                   @id @default(cuid())
  email               String                   @unique
  passwordHash        String
  userTypeId          String
  createdAt           DateTime                 @default(now())
  updatedAt           DateTime                 @updatedAt
  firstName           String?
  lastName            String?
  username            String?                  @unique
  profileImage        String?
  lastActivity        DateTime?                // Son aktivite zamanı
  lastIP              String?                  // Son bağlantı IP adresi
  lastUserAgent       String?                  // Son kullanılan tarayıcı/cihaz bilgisi
  twoFactorEnabled    Boolean                  @default(false) // 2FA aktif mi?
  twoFactorSecret     String?                  // 2FA secret key (şifreli)
  isActive            Boolean                  @default(true) // Kullanıcı aktif mi?
  bids                Bid[]
  leads               Lead[]                   @relation("LeadOwner")
  purchasedLeads      LeadSale[]               @relation("LeadBuyer")
  watching            LeadWatch[]
  userType            UserType                 @relation(fields: [userTypeId], references: [id])
  leadTypePermissions UserLeadTypePermission[] @relation("UserLeadTypePermissions")
  activityLogs        ActivityLog[]
  passwordResetTokens PasswordResetToken[]
}

model Lead {
  id              String      @id @default(cuid())
  title           String
  description     String
  privateDetails  String?     @db.Text
  postalCode      String?     // Posta kodu (örn. 85309)
  startPrice      Int
  minIncrement    Int
  instantBuyPrice Int?
  insuranceType   String?     // Sigorta türü
  isActive        Boolean     @default(true)
  isShowcase      Boolean     @default(false)
  isSold          Boolean     @default(false)
  featured        Boolean     @default(false) // Öne çıkan lead
  endsAt          DateTime
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  ownerId         String
  bids            Bid[]
  owner           User        @relation("LeadOwner", fields: [ownerId], references: [id])
  sale            LeadSale?
  watchers        LeadWatch[]
}

model Bid {
  id        String   @id @default(cuid())
  amount    Int
  createdAt DateTime @default(now())
  leadId    String
  userId    String
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])
}

model LeadWatch {
  id        String   @id @default(cuid())
  leadId    String
  userId    String
  createdAt DateTime @default(now())
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([leadId, userId])
}

model LeadSale {
  id        String   @id @default(cuid())
  leadId    String   @unique
  buyerId   String
  amount    Int
  soldAt    DateTime @default(now())
  createdAt DateTime @default(now())
  buyer     User     @relation("LeadBuyer", fields: [buyerId], references: [id])
  lead      Lead     @relation(fields: [leadId], references: [id])
}

model Settings {
  id                  String   @id @default("default")
  leadIdFormat        String   @default("numeric")
  customFormat        String   @default("L{YYYY}{MM}{DD}-{NUM}")
  leadPrefix          String   @default("LEAD")
  startingNumber      Int      @default(1)
  numberType          String   @default("sequential")
  defaultCurrency     String   @default("EUR")
  defaultAuctionDays  Int      @default(7)
  defaultMinIncrement Int      @default(10)
  homepageHeroEyebrow           String   @default("Sigorta lead pazaryeri")
  homepageHeroTitle             String   @default("Almanya'nın önde gelen")
  homepageHeroHighlight         String   @default("sigorta lead")
  homepageHeroTitleSuffix       String   @default("pazaryeri")
  homepageHeroSubtitle          String   @default("LeadPortal, sigorta brokerleri için profesyonel açık artırma altyapısı, doğrulanmış lead kalitesi ve canlı teklif takibi sunar.")
  homepageHeroPrimaryCtaText    String   @default("Şimdi kaydol")
  homepageHeroPrimaryCtaLink    String   @default("/login")
  homepageHeroSecondaryCtaText  String   @default("Canlı açık artırmaları gör")
  homepageHeroSecondaryCtaLink  String   @default("/leads")
  homepageFeatureHeading        String   @default("LeadPortal'ı neden seçmelisiniz?")
  homepageFeatures              Json     @default("[{\"icon\":\"mdi:scale-balance\",\"title\":\"Adil Açık Artırmalar\",\"description\":\"Şeffaf kurallar ve gerçek zamanlı teklifler ile esnek açık artırma modelleri.\"},{\"icon\":\"mdi:shield-check\",\"title\":\"Onaylı Kalite\",\"description\":\"Her lead yayına alınmadan önce kalite ve doğruluk kontrollerinden geçer.\"},{\"icon\":\"mdi:account-group\",\"title\":\"Güvenilir İş Ortağı\",\"description\":\"Broker topluluğumuz için doğrulama süreci ve puanlama sistemi.\"}]")
  homepageShowcaseEyebrow       String   @default("Vitrin leadler")
  homepageShowcaseTitle         String   @default("Aktüel açık artırmalar")
  homepageShowcaseCtaText       String   @default("Hepsini gör")
  homepageShowcaseCtaLink       String   @default("/leads")
  homepageStatsEyebrow          String   @default("Güven veren rakamlar")
  homepageStatsTitle            String   @default("Broker topluluğumuz büyümeye devam ediyor")
  homepageStats                 Json     @default("[{\"value\":\"2.500+\",\"label\":\"Aktif Broker\"},{\"value\":\"15.000+\",\"label\":\"Satılan Lead\"},{\"value\":\"98%\",\"label\":\"Memnuniyet\"},{\"value\":\"€2.1M\",\"label\":\"Toplam Hacim\"}]")
  homepageCtaTitle              String   @default("Başlamak için hazır mısınız?")
  homepageCtaSubtitle           String   @default("LeadPortal topluluğuna katılın, doğrulanmış leadlere erişin ve işinizi güvenle büyütün.")
  homepageCtaPrimaryText        String   @default("Ücretsiz kaydol")
  homepageCtaPrimaryLink        String   @default("/login")
  homepageCtaSecondaryText      String   @default("Leadleri incele")
  homepageCtaSecondaryLink      String   @default("/leads")
  maintenanceMode     Boolean  @default(false)
  maintenanceMessage  String   @default("Sistem bakımda. Lütfen daha sonra tekrar deneyin.")
  smtpHost            String   @default("")
  smtpPort            Int      @default(465)
  smtpUser            String   @default("")
  smtpPass            String   @default("")
  smtpFromName        String   @default("LeadPortal")
  smtpUseTLS          Boolean  @default(false)
  smtpUseSSL          Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  companyLogoUrl      String   @default("")
  companyName         String   @default("LeadPortal")
  faviconUrl          String   @default("")
  footerDescription   String   @default("Almanya'nın önde gelen lead pazar yeri. Profesyonel açık artırmalar ve lead yönetimi platformu.")
  footerEmail         String   @default("info@leadportal.com")
  footerNote          String   @default("")
  footerPhone         String   @default("+90 (212) 123 45 67")
  insuranceTypes      Json     @default("[{\"icon\": \"fa-paw\", \"name\": \"Hayvan\"}, {\"icon\": \"fa-car\", \"name\": \"Araba\"}, {\"icon\": \"fa-heart-pulse\", \"name\": \"Sağlık\"}]")
  legalLinks          Json?
  servicesLinks       Json?
  socialMedia         Json?
  supportLinks        Json?
  tradeRegisterNumber String   @default("İstanbul Ticaret Sicil No: 12345")
}

model UserType {
  id                  String               @id
  name                String
  description         String?
  isActive            Boolean              @default(true)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  leadTypePermissions LeadTypePermission[] @relation("LeadTypePermissions")
  users               User[]
  permissions         UserTypePermission[]
}

model Page {
  id          String               @id
  name        String
  description String?
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  permissions UserTypePermission[]
}

model UserTypePermission {
  id         Int      @id @default(autoincrement())
  userTypeId String
  pageId     String
  hasAccess  Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  page       Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)
  userType   UserType @relation(fields: [userTypeId], references: [id], onDelete: Cascade)

  @@unique([userTypeId, pageId])
}

model LeadTypePermission {
  id         Int      @id @default(autoincrement())
  userTypeId String
  leadType   String
  hasAccess  Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  userType   UserType @relation("LeadTypePermissions", fields: [userTypeId], references: [id], onDelete: Cascade)

  @@unique([userTypeId, leadType])
}

model UserLeadTypePermission {
  id        Int      @id @default(autoincrement())
  userId    String
  leadType  String
  hasAccess Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation("UserLeadTypePermissions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, leadType])
}

model FAQ {
  id        String   @id @default(cuid())
  question  String
  answer    String
  category  String
  isActive  Boolean  @default(true)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model About {
  id        String   @id @default(cuid())
  section   String
  title     String?
  subtitle  String?
  content   String?
  imageUrl  String?
  data      Json?
  isActive  Boolean  @default(true)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DesignSettings {
  id        String   @id @default("default")
  colors    Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EmailTemplate {
  id          String   @id @default(cuid())
  type        String   @unique
  name        String
  description String?
  subject     String
  htmlContent String
  textContent String?
  isActive    Boolean  @default(true)
  variables   Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SMSTemplate {
  id          String   @id @default(cuid())
  type        String   @unique
  name        String
  description String?
  content     String
  isActive    Boolean  @default(true)
  variables   Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ActivityLog {
  id          String   @id @default(cuid())
  userId      String
  action      String   // LOGIN, LOGOUT, VIEW_LEAD, CREATE_LEAD, EDIT_LEAD, DELETE_LEAD, CREATE_BID, PURCHASE_LEAD, ADD_WATCH, REMOVE_WATCH, VIEW_STATS, CREATE_USER, EDIT_USER, DELETE_USER, CHANGE_SETTINGS, etc.
  details     String?  // JSON string with additional details
  entityType  String?  // "lead", "bid", "user", "settings", etc.
  entityId    String?  // ID of the entity (leadId, bidId, userId, etc.)
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@index([entityType, entityId])
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}
